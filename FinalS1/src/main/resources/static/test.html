<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <!-- å¼•å…¥Bootstrap 4.1.0çš„CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- å¼•å…¥jQueryå’ŒjQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
        /* éšè—èŠå¤©çª—å£åˆå§‹çŠ¶æ€ */
        #chatWindow {
            display: none;
            position: fixed;
            bottom: 0;
            right: 20px;
            width: 300px;
            height: 400px;
            border: 1px solid #ddd;
            background-color: white;
            z-index: 1000;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;  /* é¿å…å…§å®¹æº¢å‡º */
        }

        .chat-header {
            background-color: #007bff;
            color: white;
            padding: 10px;
            cursor: move;
        }

        .chat-body {
            position: absolute;
            top: 50px;
            bottom: 50px;
            width: 100%;
            overflow-y: auto;
            padding: 10px;
        }

        .chat-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 10px;
            display: flex;
            background-color: #f1f1f1;
        }

        .chat-footer input {
            flex: 1;
            padding: 5px;
        }

        .chat-footer button {
            margin-left: 5px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 576px) {
            #chatWindow {
                width: 100%;  /* å°å±å¹•æ—¶å æ»¡å®½åº¦ */
                height: 60%;  /* é«˜åº¦è®¾ä¸º60% */
                bottom: 0;
                right: 0;
            }
        }
    </style>
</head>
<body>

    <!-- åœ“å½¢æµ®å‹•åœ–æ¨™ -->
    <button type="button" class="btn btn-primary rounded-circle fixed-bottom m-3" 
            style="width: 60px; height: 60px;" onclick="openChat()">ğŸ’¬</button>

    <!-- ç¨ç«‹çš„å¯æ‹–å‹•ã€å¯èª¿æ•´å¤§å°çš„èŠå¤©çª—å£ -->
    <div id="chatWindow">
        <div class="chat-header">èŠå¤©
            <button type="button" class="close" onclick="closeChat()">&times;</button>
        </div>
        <div class="chat-body" id="chatBox">
            <!-- èŠå¤©å…§å®¹ -->
        </div>
        <div class="chat-footer">
            <input type="text" id="messageInput" class="form-control" placeholder="è¼¸å…¥æ¶ˆæ¯...">
            <button type="button" class="btn btn-primary ml-2" onclick="sendMessage()">ç™¼é€</button>
        </div>
    </div>

    <script type="text/javascript">
        var socket;

        // æ‰“é–‹èŠå¤©çª—å£ä¸¦é€£æ¥WebSocket
        function openChat() {
            $("#chatWindow").show();  // é¡¯ç¤ºèŠå¤©çª—å£
            $(".btn-primary").hide(); // éš±è—åœ“å½¢æŒ‰éˆ•
            $("#chatWindow").draggable().resizable();  // ä½¿çª—å£å¯æ‹–å‹•å’Œå¯ç¸®æ”¾

            // å»ºç«‹ WebSocket é€£æ¥
            socket = new WebSocket("ws://localhost:8080/chat?userId=customer1");

            socket.onmessage = function(event) {
                var chatBox = document.getElementById("chatBox");
                chatBox.innerHTML += "<p>" + event.data + "</p>";
                chatBox.scrollTop = chatBox.scrollHeight;  // ä¿æŒæ»¾å‹•åˆ°åº•éƒ¨
            };
        }

        // é—œé–‰èŠå¤©çª—å£
        function closeChat() {
            $("#chatWindow").hide();    // éš±è—èŠå¤©çª—å£
            $(".btn-primary").show();   // é¡¯ç¤ºæŒ‰éˆ•
        }

        // ç™¼é€æ¶ˆæ¯
        function sendMessage() {
            var input = document.getElementById("messageInput");
            var message = input.value;
            if (message.trim() !== "") {
                socket.send(message);
                input.value = "";  // æ¸…ç©ºè¼¸å…¥æ¡†
            }
        }
    </script>

</body>
</html>
